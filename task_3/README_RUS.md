# ETL-система для анализа данных о продажах

Этот проект реализует систему ETL (Extract, Transform, Load) для анализа данных о продажах с использованием FakeStore API.

## Возможности

- Извлечение данных из FakeStore API (продукты и пользователи)
- Интеграция с базой данных PostgreSQL
- Трансформации данных, включая:
  - Анализ 10 самых дорогих продуктов
  - Нормализация данных пользователей

## Необходимые компоненты

- Python 3.8+
- База данных PostgreSQL
- pip (менеджер пакетов Python)

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:

```bash
pip install -r requirements.txt
```

3. Настройте переменные окружения:
   - Создайте файл `.env` в директории `config/` со следующим содержимым:
     ```env
     DB_HOST=localhost
     DB_PORT=5432
     DB_NAME=your_db_name
     DB_USER=your_db_user
     DB_PASSWORD=your_db_password
     API_BASE_URL=https://fakestoreapi.in/api
     ```
   - Замените значения на соответствующие вашей среде.

### О файле `settings.py`

Файл `config/settings.py` отвечает за загрузку конфигурационных значений для проекта. Он использует пакет `python-dotenv` для загрузки переменных окружения из файла `.env`, расположенного в директории `config/`. Эти переменные используются для настройки подключения к базе данных и доступа к API. Параметры конфигурации API (таймаут, количество попыток повторов) можно изменить, отредактировав их непосредственно в `settings.py`.

## Использование

Запустите ETL-процесс из директории `task_3`:

```bash
python src/main.py
```

## Как работает ETL-процесс

ETL (Extract, Transform, Load) процесс в этом проекте управляется скриптом `src/main.py` и состоит из следующих этапов:

1. **Подготовка**

   - Система создает необходимые таблицы в базе данных, выполняя скрипт `create_tables.sql`.

2. **Извлечение**

   - Данные о продуктах и пользователях извлекаются из FakeStore API с помощью класса `FakeStoreAPI`.

3. **Загрузка**

   - Извлечённые данные о продуктах и пользователях загружаются в базу данных PostgreSQL с помощью скриптов `insert_product.sql` и `insert_user.sql`.

4. **Трансформация**

   - Трансформация данных выполняется с помощью SQL-скриптов:
     - `transform_most_expensive.sql`: анализирует и сохраняет 10 самых дорогих продуктов.
     - `transform_ods_users.sql`: нормализует и обрабатывает данные пользователей для дальнейшего анализа.

5. **Обработка ошибок**
   - Процесс включает обработку ошибок при подключении к API и базе данных, а также ошибок валидации данных. Все ошибки логируются для последующего анализа.

Весь процесс управляется классом `FakeStoreETLProcess`, который реализует этапы ETL и запускается при выполнении `main.py`.

## Интерфейсы

В проекте используются интерфейсные классы (абстрактные базовые классы), определённые в `src/interfaces.py`, для обеспечения модульной и расширяемой архитектуры ETL. Эти интерфейсы включают:

- **ETLProcess**: определяет структуру ETL-процессов, требуя реализации методов подготовки, извлечения, загрузки, трансформации и запуска процесса.
- **ExtractorInterface**: определяет контракт для классов, отвечающих за извлечение данных (например, получение данных из API).
- **TransformerInterface**: определяет контракт для классов, отвечающих за трансформацию данных (например, обработка и преобразование сырых данных).
- **DatabaseInterface**: определяет контракт для классов, отвечающих за взаимодействие с базой данных (например, подключение, выполнение запросов, загрузка данных).

Использование этих интерфейсов позволяет легко расширять или заменять компоненты (например, источник API или базу данных), сохраняя при этом чёткую и последовательную структуру проекта.

## Структура проекта

```
├── config/          # Конфигурационные файлы (.env, settings.py, utils.py)
├── sql/             # SQL-скрипты для создания таблиц, загрузки и трансформации данных
├── src/             # Исходный код на Python (логика ETL, работа с БД, API, трансформации)
└── README.md        # Документация проекта
```

## Обработка ошибок

Система включает обработку следующих ошибок:

- Проблемы с подключением к API
- Проблемы с подключением к базе данных
- Ошибки валидации данных
